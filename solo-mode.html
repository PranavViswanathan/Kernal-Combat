<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solo Practice - CodeBattle Terminal</title>
    <meta name="description" content="Practice coding problems alone">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&family=VT323&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="terminal-container">
        <div class="terminal-header">
            <div class="terminal-buttons">
                <span class="terminal-button close"></span>
                <span class="terminal-button minimize"></span>
                <span class="terminal-button maximize"></span>
            </div>
            <div class="terminal-title">
                <span class="blink">‚ñà</span> Solo Practice Mode
            </div>
            <div class="terminal-actions">
                <button class="terminal-btn" onclick="navigateTo('index.html')">
                    <span class="icon">üè†</span> Home
                </button>
                <button class="terminal-btn" onclick="navigateTo('problems.html')">
                    <span class="icon">üìÅ</span> All Problems
                </button>
            </div>
        </div>

        <div class="terminal-body">
            <div class="terminal-output">
                <h1 class="section-title">&gt; SOLO PRACTICE</h1>

                <div class="terminal-info">
                    <p class="info-line">
                        <span class="prompt">$</span> Select a problem to start practicing
                    </p>
                </div>

                <div class="menu-grid">
                    <div class="menu-card" onclick="navigateTo('problems.html')">
                        <div class="menu-icon">üìö</div>
                        <h3>Browse All Problems</h3>
                        <p>Explore problems organized by topics</p>
                    </div>

                    <div class="menu-card" onclick="randomProblem()">
                        <div class="menu-icon">üé≤</div>
                        <h3>Random Problem</h3>
                        <p>Get a random problem to solve</p>
                    </div>

                    <div class="menu-card" onclick="continueLastProblem()">
                        <div class="menu-icon">‚è±Ô∏è</div>
                        <h3>Continue Last Problem</h3>
                        <p>Resume your previous problem</p>
                        <div id="lastProblemInfo" class="menu-stats" style="margin-top: 10px;">
                            <span class="stat">No recent problems</span>
                        </div>
                    </div>

                    <div class="menu-card" onclick="navigateTo('profile.html')">
                        <div class="menu-icon">üìä</div>
                        <h3>View Statistics</h3>
                        <p>Check your progress and achievements</p>
                    </div>
                </div>

                <h2 class="section-title" style="margin-top: 40px;">&gt; RECENT ACTIVITY</h2>
                <div class="editor-panel">
                    <div class="panel-content" id="recentActivity">
                        <p class="info-line">
                            <span class="prompt">$</span> No recent activity. Start solving problems!
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="terminal-footer">
            <div class="status-bar">
                <span class="status-item">
                    <span class="status-dot active"></span> READY
                </span>
                <span class="status-item">
                    USER: <span id="currentUser">Guest</span>
                </span>
                <span class="status-item">
                    TIME: <span id="currentTime"></span>
                </span>
            </div>
        </div>
    </div>

    <script src="problemLoader.js"></script>
    <script src="app.js"></script>
    <script>
        async function randomProblem() {
            const problems = await getProblems();
            const topics = Object.keys(problems);
            const randomTopic = topics[Math.floor(Math.random() * topics.length)];
            const topicProblems = problems[randomTopic];
            const randomProblem = topicProblems[Math.floor(Math.random() * topicProblems.length)];

            localStorage.setItem('currentTopic', randomTopic);
            localStorage.setItem('currentProblem', randomProblem.id);
            window.location.href = 'solve.html';
        }

        function continueLastProblem() {
            const topic = localStorage.getItem('currentTopic');
            const problem = localStorage.getItem('currentProblem');

            if (topic && problem) {
                window.location.href = 'solve.html';
            } else {
                alert('No recent problems found. Please select a problem first!');
            }
        }

        async function loadRecentActivity() {
            const solutions = JSON.parse(localStorage.getItem('solutions') || '{}');
            const activityDiv = document.getElementById('recentActivity');

            if (Object.keys(solutions).length === 0) {
                return;
            }

            const solutionsArray = Object.entries(solutions)
                .map(([id, data]) => ({ id, ...data }))
                .sort((a, b) => b.timestamp - a.timestamp)
                .slice(0, 5);

            activityDiv.innerHTML = solutionsArray.map(sol => `
                <div class="test-case" style="margin: 10px 0; cursor: pointer;" onclick="openSolution('${sol.id}')">
                    <div class="test-label">${sol.id}</div>
                    <div style="display: flex; gap: 20px; margin-top: 8px; font-size: 12px;">
                        <span>Score: <strong>${Math.floor(sol.score)}</strong></span>
                        <span>Time: <strong>${formatTime(sol.timeTaken)}</strong></span>
                        <span>Complexity: <strong>${sol.metrics.timeComplexity}</strong></span>
                    </div>
                </div>
            `).join('');

            // Update last problem info
            const lastProblem = solutionsArray[0];
            if (lastProblem) {
                document.getElementById('lastProblemInfo').innerHTML = `
                    <span class="stat">${lastProblem.id}</span>
                `;
            }
        }

        function openSolution(problemId) {
            // Find which topic this problem belongs to
            // For simplicity, we'll search localStorage for the topic
            const topic = localStorage.getItem('currentTopic');
            if (topic) {
                localStorage.setItem('currentProblem', problemId);
                window.location.href = 'solve.html';
            }
        }

        function formatTime(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;

            if (minutes > 0) {
                return `${minutes}m ${remainingSeconds}s`;
            }
            return `${remainingSeconds}s`;
        }

        function navigateTo(page) {
            window.location.href = page;
        }

        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour12: false });
            document.getElementById('currentTime').textContent = timeStr;
        }

        window.addEventListener('load', async () => {
            await loadRecentActivity();
            updateTime();
            setInterval(updateTime, 1000);

            const user = localStorage.getItem('username') || 'Guest';
            document.getElementById('currentUser').textContent = user;
        });
    </script>
</body>

</html>